{% extends 'clinical_app/base.html' %}

{% block title %}Generate {{ report_type|capfirst }} Report{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-4">
        <h1 class="display-6 fw-bold text-primary">Generate {{ report_type|capfirst }} Report</h1>
        <p class="lead text-secondary">Select parameters to create a new report.</p>
    </div>

    <div class="card shadow-lg p-4 mx-auto" style="max-width: 600px;">
        <div class="card-body">
            <form method="post" action="{% url 'generate_report' report_type=report_type %}">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="date_preset" class="form-label fw-bold">Date Range:</label>
                    <select id="date_preset" name="date_preset" onchange="toggleCustomDates()" class="form-select">
                        <option value="last_7_days">Last 7 Days</option>
                        <option value="last_30_days">Last 30 Days</option>
                        <option value="last_90_days">Last 90 Days</option>
                        <option value="this_month">This Month</option>
                        <option value="last_month">Last Month</option>
                        <option value="custom" selected>Custom Range</option>
                    </select>
                </div>

                <div id="custom_dates" class="mb-3">
                    <div class="mb-3">
                        <label for="start_date" class="form-label fw-bold">Start Date:</label>
                        <input type="date" id="start_date" name="start_date" class="form-control" required>
                    </div>
                    <div>
                        <label for="end_date" class="form-label fw-bold">End Date:</label>
                        <input type="date" id="end_date" name="end_date" class="form-control" required>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="format" class="form-label fw-bold">Format:</label>
                    <select id="format" name="format" class="form-select">
                        <option value="html">HTML</option>
                        <option value="pdf">PDF</option>
                    </select>
                </div>

                <h3 class="h5 fw-semibold text-muted mb-3">Additional Filters (Optional)</h3>
                {% if report_type == 'patient' %}
                    <div class="mb-3">
                        <label for="patient_name" class="form-label fw-bold">Patient Name (contains):</label>
                        <input type="text" id="patient_name" name="patient_name" class="form-control">
                    </div>
                {% endif %}

                <button type="submit" class="btn btn-primary w-100 btn-lg mt-3">
                    Generate Report
                </button>
            </form>
        </div>
        <button onclick="history.back()" class="btn btn-secondary mb-4">
    <i class="fas fa-arrow-left me-2"></i> Back
</button>
    </div>
</div>

<script>
    function toggleCustomDates() {
        var preset = document.getElementById('date_preset').value;
        var customDatesDiv = document.getElementById('custom_dates');
        var startDateInput = document.getElementById('start_date');
        var endDateInput = document.getElementById('end_date');

        if (preset === 'custom') {
            customDatesDiv.style.display = 'block';
            startDateInput.setAttribute('required', 'required');
            endDateInput.setAttribute('required', 'required');
        } else {
            customDatesDiv.style.display = 'none';
            startDateInput.removeAttribute('required');
            endDateInput.removeAttribute('required');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        toggleCustomDates();
    });
</script>
{% endblock %}